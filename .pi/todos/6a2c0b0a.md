{
  "id": "6a2c0b0a",
  "title": "[Follow-up] File watching and auto-reload",
  "tags": [
    "phase-3",
    "follow-up"
  ],
  "status": "completed",
  "created_at": "2026-01-27T08:59:57.205Z",
  "assigned_to_session": "40a6b513-01ef-4774-90e1-52f02661b6ad"
}

# File Watching and Auto-Reload (Follow-up)

Automatically reload the presentation when files change.

## CLI Interface

```bash
mini-presenter ./slides/ --watch
```

## Behavior

1. Watch presentation directory for changes
2. On change, notify all display tabs via WebSocket
3. Display tabs reload (preserving current hash)

## Implementation

### Server Changes (src/watcher.js)
```javascript
import { watch } from 'fs';

function watchDirectory(dir, onChange) {
  // Use fs.watch or chokidar for better cross-platform support
  watch(dir, { recursive: true }, (event, filename) => {
    if (filename.endsWith('.html') || filename.endsWith('.css') || filename.endsWith('.js')) {
      onChange(filename);
    }
  });
}
```

### WebSocket Message
```javascript
// Server → Display
{ type: 'reload', preserveHash: true }
```

### Display Handling
```javascript
// In injected.js
if (msg.type === 'reload') {
  if (msg.preserveHash) {
    location.reload();  // Hash is preserved on reload
  } else {
    location.href = '/';
  }
}
```

### Debouncing
- Multiple rapid changes → single reload
- Debounce with 100-300ms delay

## Optional: Hot Reload
For presentations that support it:
- Send changed file path
- Presentation can hot-swap CSS/content without full reload
- Requires presentation API cooperation

## Tasks
- [ ] Add --watch CLI option
- [ ] Create src/watcher.js with directory watching
- [ ] Integrate with WebSocket hub
- [ ] Send reload message on file change
- [ ] Handle reload in injected.js (preserve hash)
- [ ] Add debouncing

## Depends on
- Phase 1 complete
