{
  "id": "72fc1ee6",
  "title": "[Follow-up] PDF export via Puppeteer",
  "tags": [
    "phase-3",
    "follow-up"
  ],
  "status": "pending",
  "created_at": "2026-01-27T08:59:25.136Z"
}

# PDF Export (Follow-up)

Export presentation to PDF by capturing each slide via headless browser.

## CLI Interface

```bash
mini-presenter export ./slides/ --output slides.pdf
mini-presenter export ./slides/ --output slides.pdf --delay 500
mini-presenter export ./slides/ --format png --output ./images/
```

## Algorithm

```javascript
async function exportPDF(presentationPath, outputPath, options) {
  const browser = await puppeteer.launch({ headless: true });
  const page = await browser.newPage();
  
  // Set viewport to presentation aspect ratio
  await page.setViewport({ width: 1920, height: 1080 });
  
  // Load presentation
  await page.goto(`file://${presentationPath}`);
  
  const screenshots = [];
  const seenHashes = new Set();
  let attempts = 0;
  
  while (attempts < MAX_ATTEMPTS) {
    const hash = await page.evaluate(() => location.hash);
    
    if (seenHashes.has(hash)) break;  // Looped back
    seenHashes.add(hash);
    
    // Wait for transitions
    await page.waitForTimeout(options.delay || 300);
    
    // Capture
    screenshots.push(await page.screenshot({ type: 'png' }));
    
    // Navigate to next
    await page.keyboard.press('ArrowRight');
    
    // Wait for hash change
    const newHash = await page.evaluate(() => location.hash);
    if (newHash === hash) attempts++;
    else attempts = 0;
  }
  
  // Combine into PDF
  await combineToPDF(screenshots, outputPath);
  
  await browser.close();
}
```

## Challenges

### Detecting End
- Hash stops changing after N attempts
- Seen hash before (looped)
- Config provides total slide count

### Build Steps
- Same hash but different visual state
- May need multiple captures per hash
- Config option: `--build-steps` to capture each step

### Transition Timing
- Wait for CSS transitions to complete
- Option: fixed delay vs. DOM mutation observer

## Dependencies
- `puppeteer` package (optional dependency)

## Tasks
- [ ] Add puppeteer as optional dependency
- [ ] Create src/export.js module
- [ ] Add `export` subcommand to CLI
- [ ] Implement slide iteration logic
- [ ] Implement screenshot capture
- [ ] Implement PDF combination (use pdf-lib or similar)
- [ ] Add --delay, --format, --output options
- [ ] Handle edge cases (no hash changes, infinite loops)

## Depends on
- Phase 1 complete
- TODO-90eed9c7 (Config file - for slide list)
