{
  "id": "ee983ff6",
  "title": "WebSocket hub for display/presenter communication",
  "tags": [
    "phase-1",
    "mvp"
  ],
  "status": "closed",
  "created_at": "2026-01-27T08:57:45.215Z"
}

# WebSocket Hub

Implement WebSocket server that routes messages between display tabs and presenter tab.

## Architecture
```
Display Tab(s) ←──WS──→ Server Hub ←──WS──→ Presenter Tab
```

## Message Protocol

### Client → Server
```javascript
// Registration (on connect)
{ type: 'register', role: 'display' | 'presenter' }

// Display reports state
{ type: 'state', slideId: '#slide-1', hash: '#slide-1' }

// Presenter sends command
{ type: 'command', action: 'next' | 'prev' | 'first' | 'last' }
{ type: 'command', action: 'goto', hash: '#slide-5' }
```

### Server → Client
```javascript
// To display: navigation command
{ type: 'navigate', action: 'next' | 'prev' }
{ type: 'goto', hash: '#slide-5' }
{ type: 'key', key: 'ArrowRight' }  // Fallback

// To presenter: state update
{ type: 'state', slideId: '#slide-1', displays: 2 }

// To all: connection updates
{ type: 'sync', displays: 2, presenters: 1 }
```

## Implementation (src/websocket.js)
```javascript
import { WebSocketServer } from 'ws';  // Use 'ws' package

class Hub {
  displays = new Set();
  presenters = new Set();
  currentState = {};
  
  handleMessage(ws, message) { ... }
  broadcast(role, message) { ... }
}
```

## Tasks
- [ ] Add 'ws' package to dependencies
- [ ] Create src/websocket.js with Hub class
- [ ] Integrate with HTTP server (upgrade handling)
- [ ] Handle client registration
- [ ] Route commands from presenter to displays
- [ ] Route state from displays to presenters
- [ ] Track connection counts

## Depends on
- TODO-c724ec81 (HTTP server)
